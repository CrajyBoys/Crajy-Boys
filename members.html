<!doctype html>
<html lang="en">
<head>
  <meta charset="utf-8"/>
  <meta name="viewport" content="width=device-width,initial-scale=1"/>
  <title>Members — Crajy Boys</title>

  <link rel="icon" type="image/png" href="logo.png">

  <style>
    body{
      margin:0;
      font-family:"Segoe UI", Roboto, sans-serif;
      background:linear-gradient(180deg,#05060a,#071022);
      color:#e8fff7;
      min-height:100vh;
    }
    header{
      padding:14px 18px;
      display:flex;
      justify-content:space-between;
      align-items:center;
      border-bottom:1px solid rgba(255,255,255,0.05);
    }
    header a{color:#bfffe6;text-decoration:none;font-weight:700;}
    .main{padding:18px;max-width:1000px;margin:0 auto;}

    .join-link{
      display:inline-block;
      margin-top:16px;
      padding:10px 14px;
      background:linear-gradient(90deg,#00ffd6,#00a9ff);
      color:#001f17;
      border-radius:10px;
      font-weight:800;
      cursor:pointer;
      text-decoration:none;
    }

    .members-grid{display:flex;gap:12px;flex-wrap:wrap;margin-top:16px;}
    .member-card{
      width:220px;
      padding:10px;
      border-radius:10px;
      background:rgba(255,255,255,0.03);
    }

    /* Modal */
    .modal-bg{
      position:fixed;
      inset:0;
      display:none;
      align-items:center;
      justify-content:center;
      background:rgba(0,0,0,0.6);
      z-index:100;
    }
    .modal{
      width:92%;
      max-width:520px;
      background:linear-gradient(180deg,#071022,#0b1220);
      border-radius:12px;
      padding:16px;
    }

    .form-step{display:none;}
    .form-step.active{display:block;}

    input{
      width:100%;
      padding:8px 10px;
      border-radius:8px;
      border:1px solid rgba(255,255,255,0.1);
      background:rgba(255,255,255,0.02);
      color:#e9fff7;
      margin-top:4px;
    }

    .buttons{display:flex;justify-content:space-between;margin-top:14px;}
    button{
      padding:8px 14px;
      border-radius:8px;
      border:none;
      cursor:pointer;
      font-weight:700;
    }
    .btn-primary{background:linear-gradient(90deg,#00ffd6,#00a9ff);color:#003025;}
    .btn-ghost{background:rgba(255,255,255,0.05);color:#dffaf1;}

    .small{font-size:13px;margin-top:8px;}
    .error{color:#ffb3b3;}
    .success{color:#9fffe0;}
  </style>
</head>

<body>

<header>
  <div style="font-weight:800;color:#9fffe0;">Crajy Boys — Members</div>
  <a href="index.html">Home</a>
</header>

<main class="main">
  <a id="openJoin" class="join-link">Join / Member Form</a>

  <h3 style="margin-top:20px;">Members</h3>
  <div class="members-grid" id="membersGrid"></div>
</main>

<!-- MODAL -->
<div class="modal-bg" id="modalBg">
  <div class="modal">

    <div style="display:flex;justify-content:space-between;align-items:center;">
      <strong>Member Application</strong>
      <button id="closeModal" class="btn-ghost">Close</button>
    </div>

    <!-- STEP 1 -->
    <div class="form-step active" id="step1">
      <label>Name</label>
      <input id="q_name" type="text">

      <label style="margin-top:8px;">Date of Birth</label>
      <input id="q_dob" type="date">

      <div class="small error" id="step1Msg"></div>

      <div class="buttons">
        <div></div>
        <button id="toStep2" class="btn-primary">Next</button>
      </div>
    </div>

    <!-- STEP 2 -->
    <div class="form-step" id="step2">
      <label>Email</label>
      <input id="q_email" type="email">

      <div id="step2Msg" class="small error"></div>
      <div id="emailVerificationArea" class="small"></div>

      <div class="buttons">
        <button id="backTo1" class="btn-ghost">Previous</button>
        <button id="toStep3" class="btn-primary">Next</button>
      </div>
    </div>

    <!-- STEP 3 -->
    <div class="form-step" id="step3">
      <label>Password</label>
      <input id="q_password" type="password">

      <div class="small error" id="step3Msg"></div>

      <div class="buttons">
        <button id="backTo2" class="btn-ghost">Previous</button>
        <button id="finishBtn" class="btn-primary">Finish</button>
      </div>
    </div>

  </div>
</div>

<script>
const API_BASE = 'https://crajy-boys.onrender.com';

const modalBg = document.getElementById('modalBg');

function showStep(n){
  document.querySelectorAll('.form-step').forEach(s=>{
    s.classList.toggle('active', s.id === 'step'+n);
  });
}

document.getElementById('openJoin').onclick = ()=> modalBg.style.display='flex';
document.getElementById('closeModal').onclick = ()=> modalBg.style.display='none';

document.getElementById('toStep2').onclick = ()=>{
  const name = q_name.value.trim();
  const dob = q_dob.value;
  const msg = step1Msg;
  msg.textContent='';

  if(!name || !dob){
    msg.textContent='Please enter name and DOB.';
    return;
  }
  showStep(2);
};

document.getElementById('backTo1').onclick = ()=> showStep(1);

document.getElementById('toStep3').onclick = async ()=>{
  const email = q_email.value.trim();
  step2Msg.textContent='';

  if(!email){
    step2Msg.textContent='Please enter your email.';
    return;
  }

  step2Msg.textContent='Sending verification email...';

  const res = await fetch(API_BASE+'/register-init',{
    method:'POST',
    headers:{'Content-Type':'application/json'},
    body:JSON.stringify({
      name:q_name.value,
      email,
      dob:q_dob.value
    })
  });

  if(!res.ok){
    step2Msg.textContent='Failed to send verification email.';
    return;
  }

  emailVerificationArea.innerHTML =
    '<div class="success">Verification email sent. After verifying, click Next again.</div>';

  showStep(3);
};

document.getElementById('backTo2').onclick = ()=> showStep(2);

document.getElementById('finishBtn').onclick = async ()=>{
  const pwd = q_password.value;
  step3Msg.textContent='';

  if(pwd.length < 12){
    step3Msg.textContent='Password must be at least 12 characters.';
    return;
  }

  const res = await fetch(API_BASE+'/complete-registration',{
    method:'POST',
    headers:{'Content-Type':'application/json'},
    body:JSON.stringify({
      email:q_email.value,
      password:pwd
    })
  });

  if(res.ok){
    step3Msg.innerHTML='<span class="success">Registration complete!</span>';
    setTimeout(()=>location.reload(),1200);
  }else{
    step3Msg.textContent='Registration failed.';
  }
};
</script>

</body>
</html>
